<!DOCTYPE html>
<html>
<head>
    <title>Movie Reviews</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body>

    <h1>üé¨ Movie Reviews</h1>

    <!-- üìä STATISTICS -->
    <div class="stats-box">
        <p><strong>Total Movies:</strong> {{ total_movies }}</p>
        <p><strong>Average Rating:</strong> ‚≠ê {{ average_rating }}</p>

        {% if highest_rated %}
            <p>
                <strong>Highest Rated:</strong>
                {{ highest_rated.name }}
                (‚≠ê {{ highest_rated.rating }})
            </p>
        {% endif %}
    </div>

    <!-- üîç SEARCH + SORT + FILTER -->
    <form method="GET" action="/">
        <input type="text"
               name="search"
               placeholder="Search movie..."
               value="{{ search_query or '' }}">

        <select name="sort">
            <option value="">Sort by rating</option>
            <option value="high" {% if sort_option == "high" %}selected{% endif %}>
                ‚≠ê High ‚Üí Low
            </option>
            <option value="low" {% if sort_option == "low" %}selected{% endif %}>
                ‚≠ê Low ‚Üí High
            </option>
        </select>

        <select name="min_rating">
            <option value="">Min Rating</option>
            <option value="1" {% if filter_rating == "1" %}selected{% endif %}>‚≠ê 1+</option>
            <option value="2" {% if filter_rating == "2" %}selected{% endif %}>‚≠ê 2+</option>
            <option value="3" {% if filter_rating == "3" %}selected{% endif %}>‚≠ê 3+</option>
            <option value="4" {% if filter_rating == "4" %}selected{% endif %}>‚≠ê 4+</option>
            <option value="5" {% if filter_rating == "5" %}selected{% endif %}>‚≠ê 5</option>
        </select>

        <button type="submit">Apply</button>
        <a href="/">Clear</a>
    </form>

    <a href="/add" class="add-button">Add Movie Review</a>

    {% if movies %}
        {% for movie in movies %}
        <div class="movie-card">
            <h3>{{ movie.name }}</h3>

            <p>
                {% for i in range(movie.rating|int) %}
                    ‚≠ê
                {% endfor %}
            </p>

            <p>{{ movie.review }}</p>

            <a href="/edit/{{ loop.index0 }}" class="edit-button">Edit</a>

            <form action="/delete/{{ loop.index0 }}"
                  method="POST"
                  style="display:inline;"
                  onsubmit="return confirm('Are you sure you want to delete this review?');">
                <button type="submit" class="delete-button">Delete</button>
            </form>
        </div>
        {% endfor %}
    {% else %}
        <p style="font-size:18px; color: gray; margin-top:20px;">
            üé• No movie reviews found.
        </p>
    {% endif %}

</body>
</html>